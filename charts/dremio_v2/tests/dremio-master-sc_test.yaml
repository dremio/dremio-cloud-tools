templates:
  - dremio-master-sc.yaml
tests:
  - it: dremio-master-sc should be included when
        'masterCoordinator.persistentStorage.provider' is set
    set:
      masterCoordinator:
        persistentStorage:
          provider: azure
    asserts:
      - hasDocuments:
          count: 1
      - equal:
          path: metadata.name
          value: dremio-master-sc
      - isKind:
          of: StorageClass
  - it: provisioner should be set to 'file.csi.azure.com'
        when using Azure
    set:
      masterCoordinator:
        persistentStorage:
          provider: azure
    asserts:
      - equal:
          path: provisioner
          value: file.csi.azure.com
  - it: provisioner should be set to 'filestore.csi.storage.gke.io'
        when using GCP
    set:
      masterCoordinator:
        persistentStorage:
          provider: gcp
    asserts:
      - equal:
          path: provisioner
          value: filestore.csi.storage.gke.io
  - it: parameters should be included when 
        'masterCoordinator.persistentStorage.parameters' is set
    set:
      masterCoordinator:
        persistentStorage:
          provider: test
          parameters:
            testKey: testValue
    asserts:
      - equal:
          path: parameters.testKey
          value: testValue
  - it: mountOptions should be included for Azure
    set:
      masterCoordinator:
        persistentStorage:
          provider: azure
    asserts:
      - exists:
          path: mountOptions